## 软件分析与验证大作业实验报告

#### 部分正确性验证实现

###### 实验目标

对于给定的带有部分正确性验证标注的输入程序源码，返回其部分正确性验证结果

###### 算法实现

算法主要完成了从控制流图（CFG）到验证结果的部分，代码主要分为两个模块：查找基本路径的函数bool find_basic_path()和验证程序bool wlp_check()

find_basic_path()函数使用递归的方法在CFG中寻找Basic Path，依据以下规则

- 基本路径开始于程序的precondition或者一个循环不变式
- 基本路径结束于循环不变式或程序的postcondition
- 基本路径不穿过循环

将根据上述规则找到的基本路径传递给验证程序bool wlp_check()检查其正确性。



wlp_check()函数检查一个基本路径的部分正确性，从路径的postcondition出发，使用wlp方法，得到路径的最弱前提条件P‘，与原条件P比较。使用SMTSolver验证p->p'，得到结果即为程序的部分正确性。

###### 实现中的难点

- 寻找基本路径的算法中，使用递归的方法，但是给定的CFG控制流图是有环的，在递归时要主要条件，避免在某些情况下产生死循环。本算法在遇到下一个节点是循环头时，判断当前节点是循环头的前驱节点的第一个，如果是第一个，则说明当前节点在循环外部，可以放心进入循环；如果不是第一个，说明当前节点已经在循环内部，此语句重新回到循环头，应该在此结束，不进入循环。
- 正确性验证算法中，路径中的statement种类非常多，对每一个statement的类型都要进行分别处理，尤其是过程调用和数组下标复制的语句处理起来较为复杂。